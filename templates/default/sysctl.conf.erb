# Generated by Chef for <%= node["fqdn"] %>
# Local modifications will be overwritten.
# Kernel sysctl configuration file for Red Hat Linux
#
# For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and
# sysctl.conf(5) for more details.

# Controls IP packet forwarding
net.ipv4.ip_forward = <%= node["net"]["ipv4"]["ip_forward"] %>

# Controls source route verification
net.ipv4.conf.default.rp_filter = <%= node["net"]["ipv4"]["conf"]["default"]["rp_filter"] %>

# Do not accept source routing
net.ipv4.conf.default.accept_source_route = <%= node["net"]["ipv4"]["conf"]["default"]["accept_source_route"] %>

# Controls the System Request debugging functionality of the kernel
kernel.sysrq = <%= node["kernel"]["sysrq"] %>

# Controls whether core dumps will append the PID to the core filename
# Useful for debugging multi-threaded applications
kernel.core_uses_pid = <%= node["kernel"]["core_uses_pid"] %>

# Controls the use of TCP syncookies
net.ipv4.tcp_syncookies = <%= node["net"]["ipv4"]["tcp_syncookies"] %>

# Controls the maximum size of a message, in bytes
kernel.msgmnb = <%= node["kernel"]["msgmnb"] %>

# Controls the default maxmimum size of a mesage queue
kernel.msgmax = <%= node["kernel"]["msgmax"] %>

# Controls the maximum shared segment size, in bytes
kernel.shmmax = <%= node["kernel"]["shmmax"] %>

# Controls the maximum number of shared memory segments, in pages
kernel.shmall = <%= node["kernel"]["shmall"] %>

<% if node["sysctl"]["is_oracle"] -%>
# Controls the system wide maximum number of shared memory segments
kernel.shmmni = <%= node["kernel"]["shmmni"] %>

# semmsl, controls the maximum number of semaphores per semaphore set.
# semmns, controls the total number of semaphores (not semaphore sets) for the entire system.
# semopm, the maximum number of semaphore operations that can be performed per semaphore system call.
# semmni, the maximum number of semaphore sets for the entire system.
kernel.sem = <%= node["kernel"]["semmsl"] %> <%= node["kernel"]["semmns"] %> <%= node["kernel"]["semopm"] %> <%= node["kernel"]["semmni"] %>

# Default setting in bytes of the socket receive buffer
net.core.rmem_default = <%= node["net"]["core"]["rmem_default"] %>

# Default setting in bytes of the socket send buffer
net.core.wmem_default = <%= node["net"]["core"]["wmem_default"] %>

# Maximum socket receive buffer size which may be set by using the SO_RCVBUF socket option
net.core.rmem_max = <%= node["net"]["core"]["rmem_max"] %>

# Maximum socket send buffer size which may be set by using the SO_SNDBUF socket option
net.core.wmem_max = <%= node["net"]["core"]["wmem_max"] %>

# Controls the default range of IP port numbers that are allowed for TCP and UDP traffic
net.ipv4.ip_local_port_range = <%= node["net"]["ipv4"]["ip_local_port_range"] %>

<% if node["oracle"]["version"].to_i >= 11 -%>
# Limit concurrent outstanding I/O requests
fs.aio-max-nr = <%= node["fs"]["aio_max_nr"] %>
<% end -%>
<% end -%>

<% if node["sysctl"]["is_oracle"] or node["sysctl"]["is_oracle_client"] -%>

# fs.file-max controls the maximum number of file handles for the entire system.
fs.file-max = <%= node["fs"]["file_max"] %>
<% end -%>
<% if node["sysctl"]["has_iscsi"] -%>

# Prevent ARP from misbehaving with multiple interfaces on same subnet.
net.ipv4.conf.all.arp_ignore = <%= node["net"]["ipv4"]["conf"]["all"]["arp_ignore"] %>
net.ipv4.conf.all.arp_announce = <%= node["net"]["ipv4"]["conf"]["all"]["arp_announce"] %>

# disable TCP window tracking for iSCSI
net.ipv4.netfilter.ip_conntrack_tcp_be_liberal = <%= node["net"]["ipv4"]["netfilter"]["ip_conntrack_tcp_be_liberal"] %>
<% end -%>

<% unless node["sysctl"]["vm"]["nr_hugepages"].nil? -%>
vm.nr_hugepages = <%= node["sysctl"]["vm"]["nr_hugepages"] %>
<% end -%>
